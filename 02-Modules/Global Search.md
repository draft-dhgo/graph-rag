---
title: ê¸€ë¡œë²Œ ê²€ìƒ‰
tags:
  - query
  - search
  - global
  - community-level
created: 2025-01-12
type: documentation
links:
  - [[Query Module]]
  - [[Local Search]]
  - [[Community]]
  - [[Community Report]]
---

# ê¸€ë¡œë²Œ ê²€ìƒ‰

**ê¸€ë¡œë²Œ ê²€ìƒ‰**ì€ ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨ ìš”ì•½ì„ í†µí•´ ì „ì²´ ì§€ì‹ ê·¸ë˜í”„ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ë©”ì„œë“œì…ë‹ˆë‹¤. ì „ì²´ ë°ì´í„°ì…‹ì„ ì´í•´í•´ì•¼ í•˜ëŠ” ê´‘ë²”ìœ„í•œ ì§ˆë¬¸ì— ê°€ì¥ ì í•©í•©ë‹ˆë‹¤.

## ğŸ¯ ì‚¬ìš© ì‚¬ë¡€

ê¸€ë¡œë²Œ ê²€ìƒ‰ì€ ë‹¤ìŒì— íƒì›”í•©ë‹ˆë‹¤:
- "ì´ ë°ì´í„°ì…‹ì˜ ì£¼ìš” í…Œë§ˆëŠ” ë¬´ì—‡ì¸ê°€?"
- "ëª¨ë“  ë¬¸ì„œì˜ ì£¼ìš” ì£¼ì œë¥¼ ìš”ì•½í•´ë¼"
- "ì£¼ì œ ê°„ì˜ ìƒìœ„ ìˆ˜ì¤€ ê´€ê³„ëŠ” ë¬´ì—‡ì¸ê°€?"
- "ì „ì²´ ë§ë­‰ì¹˜ì˜ ê°œìš”ë¥¼ ì•Œë ¤ë‹¬ë¼"

## ğŸ—ï¸ ì‘ë™ ë°©ì‹

ê¸€ë¡œë²Œ ê²€ìƒ‰ì€ **map-reduce ì•„í‚¤í…ì²˜**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```
ì¿¼ë¦¬ -> ì»¤ë®¤ë‹ˆí‹° ì„ íƒ -> ë§µ ë‹¨ê³„ (ë³‘ë ¬) ->
ë¦¬ë“€ìŠ¤ ë‹¨ê³„ -> LLM ìƒì„± -> ì‘ë‹µ
```

### ë‹¨ê³„ 1: ì»¤ë®¤ë‹ˆí‹° ì„ íƒ

ì§€ì •ëœ ë ˆë²¨ì˜ ëª¨ë“  ì»¤ë®¤ë‹ˆí‹°ê°€ ì„ íƒë©ë‹ˆë‹¤:
- ë ˆë²¨ 0: ë£¨íŠ¸ ì»¤ë®¤ë‹ˆí‹° (ëª¨ë“  ì—”í‹°í‹°)
- ë ˆë²¨ 1-3: ê³„ì¸µì  í•˜ìœ„ ë¶„ë¥˜
- ê¸°ë³¸ê°’: ë ˆë²¨ 2 (ì¤‘ê°„ ì„¸ë¶„ì„±)

### ë‹¨ê³„ 2: ë§µ ë‹¨ê³„

ê° ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ê°€ ë³‘ë ¬ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤:

```python
async def map_community(
    community_report: CommunityReport,
    query: str,
) -> str:
    """í•˜ë‚˜ì˜ ì»¤ë®¤ë‹ˆí‹°ì— ëŒ€í•œ ì¤‘ê°„ ë‹µë³€ ìƒì„±"""
    prompt = f"""
    ë‹¤ìŒ ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ê°€ ì£¼ì–´ì¡Œì„ ë•Œ:
    {community_report.full_content}

    ê·¸ë¦¬ê³  ì§ˆë¬¸: {query}

    ì´ ì»¤ë®¤ë‹ˆí‹°ì— ì§‘ì¤‘í•œ ê°„ë‹¨í•œ ì¤‘ê°„ ë‹µë³€ì„ ì œê³µí•˜ì„¸ìš”.
    """
    return await llm.execute(prompt)
```

### ë‹¨ê³„ 3: ë¦¬ë“€ìŠ¤ ë‹¨ê³„

ì¤‘ê°„ ë‹µë³€ì´ ì§‘ê³„ë©ë‹ˆë‹¤:

```python
async def reduce_answers(
    intermediate_answers: list[str],
    query: str,
) -> str:
    """ì¤‘ê°„ ë‹µë³€ì„ ìµœì¢… ì‘ë‹µìœ¼ë¡œ ê²°í•©"""
    prompt = f"""
    ì§ˆë¬¸ "{query}"ì— ëŒ€í•œ ë‹¤ìŒ ì¤‘ê°„ ë‹µë³€ì´ ì£¼ì–´ì¡Œì„ ë•Œ:
    {join_answers(intermediate_answers)}

    í¬ê´„ì ì¸ ìµœì¢… ë‹µë³€ì„ ì¢…í•©í•˜ì„¸ìš”.
    """
    return await llm.execute(prompt)
```

### ë‹¨ê³„ 4: ìµœì¢… ìƒì„±

ìµœì¢… ë‹µë³€ì´ í¬ë§·ë˜ì–´ ë°˜í™˜ë©ë‹ˆë‹¤.

## âš™ï¸ êµ¬ì„±

### YAML êµ¬ì„±

```yaml
global_search:
  # í† í° ì œí•œ
  max_tokens: 12000           # ìµœëŒ€ ì „ì²´ í† í°
  data_max_tokens: 12000      # ì»¤ë®¤ë‹ˆí‹° ë°ì´í„°ì˜ ìµœëŒ€ê°’
  map_max_tokens: 1000        # ì»¤ë®¤ë‹ˆí‹°ë³„ í”„ë¡¬í”„íŠ¸ ì œí•œ
  reduce_max_tokens: 2000     # ì§‘ê³„ í”„ë¡¬í”„íŠ¸ ì œí•œ

  # ë™ì‹œì„±
  concurrency: 32             # ë³‘ë ¬ ì»¤ë®¤ë‹ˆí‹° ì²˜ë¦¬

  # ì»¤ë®¤ë‹ˆí‹° ì„ íƒ
  community_level: 2          # ê³„ì¸µ ë ˆë²¨ (0-3)

  # ë™ì  ì„ íƒ
  dynamic_community_selection: true  # ê´€ë ¨ ì»¤ë®¤ë‹ˆí‹°ë§Œ ì‚¬ìš©
```

### í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì‚¬ìš©

```python
from graphrag.api import global_search

result = await global_search(
    query="ì£¼ìš” í…Œë§ˆëŠ” ë¬´ì—‡ì¸ê°€?",
    config="./settings.yaml",
    community_level=2,
)
```

## ğŸ“Š ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨

ì»¤ë®¤ë‹ˆí‹° ê³„ì¸µ êµ¬ì¡° ì´í•´:

```
ë ˆë²¨ 0 (ë£¨íŠ¸)
â”œâ”€â”€ ë ˆë²¨ 1
â”‚   â”œâ”€â”€ ë ˆë²¨ 2 (ê¸°ë³¸ê°’ - ì¤‘ê°„ ì„¸ë¶„ì„±)
â”‚   â”‚   â”œâ”€â”€ ë ˆë²¨ 3 (ë¯¸ì„¸ ì„¸ë¶„ì„±)
â”‚   â”‚   â””â”€â”€ ë ˆë²¨ 3
â”‚   â””â”€â”€ ë ˆë²¨ 2
â”‚       â””â”€â”€ ë ˆë²¨ 3
```

| ë ˆë²¨ | ì„¤ëª… | ìµœì  ìš©ë„ |
|-------|-------------|----------|
| 0 | ë£¨íŠ¸ (ëª¨ë“  ì—”í‹°í‹°) | ë§¤ìš° ê´‘ë²”ìœ„í•œ ê°œìš” |
| 1 | ì£¼ìš” ì£¼ì œ ì˜ì—­ | ìƒìœ„ ìˆ˜ì¤€ í…Œë§ˆ |
| 2 | í•˜ìœ„ ì£¼ì œ | ê¸°ë³¸ê°’ - ê· í˜• |
| 3 | ë¯¸ì„¸ ì„¸ë¶„ì„± | ìƒì„¸ ë¶„ì„ |

## ğŸ†š ë‹¤ë¥¸ ë©”ì„œë“œì™€ì˜ ë¹„êµ

| ì¸¡ë©´ | ê¸€ë¡œë²Œ ê²€ìƒ‰ | ë¡œì»¬ ê²€ìƒ‰ | DRIFT ê²€ìƒ‰ |
|--------|---------------|--------------|--------------|
| **ë²”ìœ„** | ì „ì²´ ê·¸ë˜í”„ | 2-3 í™‰ ì´ì›ƒ | ë°˜ë³µì  í™•ì¥ |
| **ìµœì  ìš©ë„** | ê´‘ë²”ìœ„í•œ ì£¼ì œ | êµ¬ì²´ì ì¸ ì—”í‹°í‹° | ë³µì¡í•œ multi-hop |
| **ì»¨í…ìŠ¤íŠ¸** | ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ | ì—”í‹°í‹° + í…ìŠ¤íŠ¸ ìœ ë‹› | ë™ì  |
| **ì†ë„** | ì¤‘ê°„ (ë³‘ë ¬) | ë¹ ë¦„ | ëŠë¦¼ |
| **í† í° ì‚¬ìš©ëŸ‰** | ë†’ìŒ | ì¤‘ê°„ | ë†’ìŒ |
| **ë³‘ë ¬í™”** | ìˆìŒ (ë§µ ë‹¨ê³„) | ì—†ìŒ | ìˆìŒ (í”„ë¼ì´ë¨¸) |

## ğŸ“Š Map-Reduce ì˜ˆì‹œ

### ì…ë ¥ ì¿¼ë¦¬
"ì£¼ìš” ì—°êµ¬ ë¶„ì•¼ëŠ” ë¬´ì—‡ì¸ê°€?"

### ë§µ ë‹¨ê³„ (ë³‘ë ¬)
```
ì»¤ë®¤ë‹ˆí‹° 1 (AI): "ì´ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ì—°êµ¬ì— ì§‘ì¤‘í•©ë‹ˆë‹¤..."
  -> "AIì™€ ë¨¸ì‹ ëŸ¬ë‹ì´ ì£¼ìš” ë¶„ì•¼ì…ë‹ˆë‹¤"

ì»¤ë®¤ë‹ˆí‹° 2 (í´ë¼ìš°ë“œ): "ì´ ì»¤ë®¤ë‹ˆí‹°ëŠ” í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì„ ë‹¤ë£¹ë‹ˆë‹¤..."
  -> "í´ë¼ìš°ë“œ ì¸í”„ë¼ê°€ ë˜ ë‹¤ë¥¸ ì¤‘ì  ë¶„ì•¼ì…ë‹ˆë‹¤"

ì»¤ë®¤ë‹ˆí‹° 3 (ë³´ì•ˆ): "ì´ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³´ì•ˆì— ëŒ€í•´ ë…¼ì˜í•©ë‹ˆë‹¤..."
  -> "ë³´ì•ˆê³¼ ê°œì¸ì •ë³´ ë³´í˜¸ê°€ ì¤‘ìš”í•œ ì£¼ì œì…ë‹ˆë‹¤"
```

### ë¦¬ë“€ìŠ¤ ë‹¨ê³„
```
ì…ë ¥: ["AIì™€ ë¨¸ì‹ ëŸ¬ë‹ì´ ì£¼ìš” ë¶„ì•¼ì…ë‹ˆë‹¤",
        "í´ë¼ìš°ë“œ ì¸í”„ë¼ê°€ ë˜ ë‹¤ë¥¸ ì¤‘ì  ë¶„ì•¼ì…ë‹ˆë‹¤",
        "ë³´ì•ˆê³¼ ê°œì¸ì •ë³´ ë³´í˜¸ê°€ ì¤‘ìš”í•œ ì£¼ì œì…ë‹ˆë‹¤"]

ì¶œë ¥: "ì£¼ìš” ì—°êµ¬ ë¶„ì•¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
        1. AI ë° ë¨¸ì‹ ëŸ¬ë‹
        2. í´ë¼ìš°ë“œ ì¸í”„ë¼
        3. ë³´ì•ˆ ë° ê°œì¸ì •ë³´ ë³´í˜¸"
```

## ğŸ”§ êµ¬í˜„ ì„¸ë¶€ ì •ë³´

### ìœ„ì¹˜
`/graphrag/query/llm/global_search/global_search.py`

### ì£¼ìš” í•¨ìˆ˜

```python
async def global_search(
    query: str,
    community_reports: pd.DataFrame,
    chat_model: LanguageModel,
    token_encoder: Tokenizer,
    community_level: int = 2,
) -> SearchResult:
    # 1. ë ˆë²¨ì˜ ì»¤ë®¤ë‹ˆí‹° ì„ íƒ
    communities = select_communities(community_reports, community_level)

    # 2. ë§µ ë‹¨ê³„ (ë³‘ë ¬)
    intermediate_answers = await asyncio.gather(*[
        map_community(comm, query)
        for comm in communities
    ])

    # 3. ë¦¬ë“€ìŠ¤ ë‹¨ê³„
    final_answer = await reduce_answers(intermediate_answers, query)

    return SearchResult(final_answer)
```

## ğŸ’¡ ìµœì  ê²°ê³¼ë¥¼ ìœ„í•œ íŒ

1. **ê´‘ë²”ìœ„í•œ ì§ˆë¬¸ ì‚¬ìš©**: í…Œë§ˆì™€ íŒ¨í„´ì— ëŒ€í•´ ì§ˆë¬¸
   - "ë…¼ì˜ëœ ì£¼ìš” ì£¼ì œëŠ” ë¬´ì—‡ì¸ê°€?" (O)
   - "ì£¼ìš” í…Œë§ˆë¥¼ ìš”ì•½í•´ë¼" (O)
   - "Xì™€ Yì˜ ê´€ê³„ëŠ” ë¬´ì—‡ì¸ê°€?" (ë¡œì»¬ ê²€ìƒ‰ ì‚¬ìš©) (X)

2. **ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨ ì¡°ì •**:
   - ë ˆë²¨ 0-1: ë§¤ìš° ê´‘ë²”ìœ„í•œ ê°œìš”
   - ë ˆë²¨ 2: ê· í˜• (ê¸°ë³¸ê°’)
   - ë ˆë²¨ 3: ë” ìƒì„¸í•œ

3. **ë™ì  ì„ íƒ í™œì„±í™”**: ëŒ€í˜• ë°ì´í„°ì…‹ì˜ ê²½ìš°
   ```yaml
   dynamic_community_selection: true
   ```

## ğŸ› ë¬¸ì œ í•´ê²°

### ì»¤ë®¤ë‹ˆí‹°ê°€ ë„ˆë¬´ ë§ìŒ
**ë¬¸ì œ**: ë§µ ë‹¨ê³„ê°€ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¼

**í•´ê²° ë°©ë²•**:
- ë” í° ì»¤ë®¤ë‹ˆí‹°ë¥¼ ìœ„í•´ `community_level` ì¦ê°€
- rate limitì— ë„ë‹¬í•˜ë©´ `concurrency` ê°ì†Œ
- `dynamic_community_selection` í™œì„±í™”

### ë‹µë³€ì´ ë„ˆë¬´ ì¼ë°˜ì 
**ë¬¸ì œ**: ì‘ë‹µì— ì„¸ë¶€ ì •ë³´ê°€ ë¶€ì¡±í•¨

**í•´ê²° ë°©ë²•**:
- ë” ë§ì€ ì„¸ë¶€ ì •ë³´ë¥¼ ìœ„í•´ `community_level` ê°ì†Œ
- ë” í’ë¶€í•œ ì¤‘ê°„ ë‹µë³€ì„ ìœ„í•´ `map_max_tokens` ì¦ê°€
- êµ¬ì²´ì ì¸ ì‚¬í•­ì€ ë¡œì»¬ ê²€ìƒ‰ìœ¼ë¡œ í›„ì†

## ğŸ”— ê´€ë ¨ ì£¼ì œ

- [[Local Search]] - ì—”í‹°í‹° ì¤‘ì‹¬ ê²€ìƒ‰
- [[DRIFT Search]] - ë°˜ë³µì  ì •ì œ
- [[Community]] - ì»¤ë®¤ë‹ˆí‹° êµ¬ì¡°
- [[Community Report]] - ì»¤ë®¤ë‹ˆí‹° ìš”ì•½
- [[Leiden Algorithm]] - ì»¤ë®¤ë‹ˆí‹° ê°ì§€

---
*ì°¸ê³ : [[Query Module]], [[Local Search]], [[Community]]*
