---
title: GraphRAG ì¿¼ë¦¬ ëª¨ë“ˆ
tags:
  - module
  - query
  - search
  - retrieval
created: 2025-01-12
type: documentation
links:
  - [[Architecture Overview]]
  - [[Index Module]]
  - [[Local Search]]
  - [[Global Search]]
  - [[DRIFT Search]]
---

# GraphRAG ì¿¼ë¦¬ ëª¨ë“ˆ

**ì¿¼ë¦¬ ëª¨ë“ˆ** (`/graphrag/query/`)ì€ ì§€ì‹ ê·¸ë˜í”„ì— ëŒ€í•œ ì •êµí•œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë©°, ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì§ˆë¬¸ì— ìµœì í™”ëœ ì—¬ëŸ¬ ì¿¼ë¦¬ ì „ëµì„ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ“‹ ê°œìš”

ì¿¼ë¦¬ ëª¨ë“ˆì€ 4ê°€ì§€ ê³ ìœ í•œ ê²€ìƒ‰ ë©”ì„œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤:
- [[Local Search]] - ì—”í‹°í‹° ì¤‘ì‹¬, êµ¬ì²´ì ì¸ ì§ˆë¬¸
- [[Global Search]] - ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨, ê´‘ë²”ìœ„í•œ ì§ˆë¬¸
- [[DRIFT Search]] - ë³µì¡í•œ multi-hop ì§ˆë¬¸
- [[Local Search]] - ì „í†µì ì¸ RAG ì ‘ê·¼ ë°©ì‹

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```mermaid
flowchart TB
    QM[Query Module]

    subgraph Search["Search Methods"]
        LS[[Local Search]]
        GS[[Global Search]]
        DS[[DRIFT Search]]
    end

    subgraph Context["Context Builders"]
        LC[[Local Search]]
        GC[[Global Search]]
        DC[[DRIFT Search]]
    end

    LLM[LLM Service<br/>Response Generation]

    QM --> LS
    QM --> GS
    QM --> DS

    LS --> LC
    GS --> GC
    DS --> DC

    LC --> LLM
    GC --> LLM
    DC --> LLM

    style QM fill:#e1f5fe
    style Search fill:#fff3e0
    style Context fill:#fce4ec
    style LLM fill:#c8e6c9
```

## ğŸ” ê²€ìƒ‰ ë©”ì„œë“œ

### ë¡œì»¬ ê²€ìƒ‰

**ìµœì  ìš©ë„**: íŠ¹ì • ì—”í‹°í‹°ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì§ˆë¬¸

**íŠ¹ì§•**:
- 2-3 í™‰ ë‚´ì˜ ê·¼ì ‘ ì—”í‹°í‹° ì¿¼ë¦¬
- í…ìŠ¤íŠ¸ ìœ ë‹› ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©
- ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸, ì—”í‹°í‹°, ê´€ê³„, í…ìŠ¤íŠ¸ ìœ ë‹› ê²°í•©
- ë¹„ë¡€ì  í† í° í• ë‹¹:
  - 50% í…ìŠ¤íŠ¸ ìœ ë‹›
  - 25% ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸
  - 25% ë¡œì»¬ ì—”í‹°í‹°/ê´€ê³„

**ì˜ˆì‹œ ì¿¼ë¦¬**:
```
"Microsoftì˜ AI ì—°êµ¬ì— ëˆ„ê°€ ê´€ì—¬í•˜ê³  ìˆë‚˜?"
"Xì™€ Yì˜ ê´€ê³„ëŠ” ë¬´ì—‡ì¸ê°€?"
```

**ì°¸ê³ **: [[Local Search]]

### ê¸€ë¡œë²Œ ê²€ìƒ‰

**ìµœì  ìš©ë„**: ì „ì²´ ê·¸ë˜í”„ ì»¨í…ìŠ¤íŠ¸ê°€ í•„ìš”í•œ ê´‘ë²”ìœ„í•œ ì§ˆë¬¸

**íŠ¹ì§•**:
- ì „ì²´ ì§€ì‹ ê·¸ë˜í”„ ì»¨í…ìŠ¤íŠ¸ í™œìš©
- ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ í™œìš©
- ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ map-reduce ì•„í‚¤í…ì²˜
- ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨ ì¸ì‚¬ì´íŠ¸ ì§‘ê³„

**ì˜ˆì‹œ ì¿¼ë¦¬**:
```
"ì´ ë°ì´í„°ì…‹ì˜ ì£¼ìš” í…Œë§ˆëŠ” ë¬´ì—‡ì¸ê°€?"
"ëª¨ë“  ë¬¸ì„œì˜ ì£¼ìš” ì£¼ì œë¥¼ ìš”ì•½í•´ë¼."
```

**ì°¸ê³ **: [[Global Search]]

### DRIFT ê²€ìƒ‰

**ìµœì  ìš©ë„**: ë³µì¡í•œ multi-hop ì§ˆë¬¸

**íŠ¹ì§•**:
- í”„ë¼ì´ë¨¸ ë‹¨ê³„ë¥¼ í†µí•œ ë°˜ë³µì  ì¿¼ë¦¬ ì •ì œ
- ì‹œê°„ ë˜ëŠ” ê°œë… ê¸°ë°˜ ê²€ìƒ‰
- ì—”í‹°í‹° ì§„í™” ì¶”ì 
- ìƒíƒœ ê¸°ë°˜ ì¿¼ë¦¬ ê´€ë¦¬

**ì˜ˆì‹œ ì¿¼ë¦¬**:
```
"ê°œë… Aê°€ ë§ë­‰ì¹˜ë¥¼ í†µí•´ ê°œë… Bì™€ ì–´ë–»ê²Œ ê´€ë ¨ë˜ëŠ”ê°€?"
"ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ì´ ì£¼ì œì˜ ë°œì „ì„ ì¶”ì í•´ë¼."
```

**ì°¸ê³ **: [[DRIFT Search]]

### ê¸°ë³¸ ê²€ìƒ‰

**ìµœì  ìš©ë„**: ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì¿¼ë¦¬

**íŠ¹ì§•**:
- ì „í†µì ì¸ RAG ì ‘ê·¼ ë°©ì‹
- ê·¸ë˜í”„ êµ¬ì¡° ë¯¸í™œìš©
- ë²¡í„° ì„ë² ë”©ë§Œ ì‚¬ìš©
- ê°„ë‹¨í•œ ìœ ì‚¬ë„ ê²€ìƒ‰

**ì˜ˆì‹œ ì¿¼ë¦¬**:
```
"Xì— ëŒ€í•œ ë¬¸ì„œë¥¼ ì°¾ì•„ë¼."
```

## ğŸ—ï¸ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”

### ë¡œì»¬ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”

**ìœ„ì¹˜**: `/graphrag/query/llm/local_search/context_builder.py`

**ëª©ì **: ë¡œì»¬ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥**:
- ì˜¤ë²„ìƒ˜í”Œë§ì´ í¬í•¨ëœ ì˜ë¯¸ ìœ ì‚¬ë„ë¥¼ í†µí•œ ì—”í‹°í‹° ì¶”ì¶œ
- ê´€ê³„ ìš°ì„ ìˆœìœ„:
  1. ë„¤íŠ¸ì›Œí¬ ë‚´ ì—°ê²°
  2. ë„¤íŠ¸ì›Œí¬ ì™¸ ì—°ê²°
  3. ë‹¨ì¼ ì—°ê²°
- í† í° ì¸ì‹ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬
- êµ¬ì„± ê°€ëŠ¥í•œ ì»¨í…ìŠ¤íŠ¸ ì œí•œ

**í”„ë¡œì„¸ìŠ¤**:
1. ì˜ë¯¸ ìœ ì‚¬ë„ë¥¼ í†µí•´ ê´€ë ¨ ì—”í‹°í‹° ì°¾ê¸°
2. N í™‰ ë‚´ì˜ ê´€ë ¨ ì—”í‹°í‹° ê°€ì ¸ì˜¤ê¸°
3. ìœ í˜•ë³„ ê´€ê³„ ìš°ì„ ìˆœìœ„ ì§€ì •
4. ë¹„ë¡€ì  ì»¨í…ìŠ¤íŠ¸ ë¹Œë“œ

### ê¸€ë¡œë²Œ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”

**ìœ„ì¹˜**: `/graphrag/query/llm/global_search/`

**ëª©ì **: ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥**:
- ì»¤ë®¤ë‹ˆí‹° ë ˆë²¨ ìš”ì•½ ì§‘ê³„
- ê³„ì¸µì  ì»¨í…ìŠ¤íŠ¸ ì¡°ë¦½
- ì»¤ë®¤ë‹ˆí‹° ë³‘ë ¬ ì²˜ë¦¬
- í† í° ì˜ˆì‚° ê´€ë¦¬

### DRIFT ì»¨í…ìŠ¤íŠ¸ ë¹Œë”

**ìœ„ì¹˜**: `/graphrag/query/llm/drift_search/context_builder.py`

**ëª©ì **: ë°˜ë³µì  DRIFT ê²€ìƒ‰ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥**:
- ì´ˆê¸° íƒìƒ‰ì„ ìœ„í•œ í”„ë¼ì´ë¨¸ ë‹¨ê³„
- ìƒì„¸ ë¶„ì„ì„ ìœ„í•œ ì •ì œ ë‹¨ê³„
- ë°˜ë³µ ê°„ ìƒíƒœ ê´€ë¦¬
- ë™ì  ì¿¼ë¦¬ í™•ì¥

## ğŸ”§ íŒ©í† ë¦¬ íŒ¨í„´

### ì¿¼ë¦¬ ì—”ì§„ íŒ©í† ë¦¬

**ìœ„ì¹˜**: `/graphrag/query/factory.py`

```python
class QueryEngineFactory:
    def create_engine(
        self,
        config: GraphRagConfig,
        data: QueryData,
    ) -> BaseSearchEngine:
        method = config.search_method
        if method == SearchMethod.LOCAL:
            return LocalSearchEngine(config, data)
        elif method == SearchMethod.GLOBAL:
            return GlobalSearchEngine(config, data)
        # ... ë‹¤ë¥¸ ë©”ì„œë“œ
```

## ğŸ¯ ì§ˆë¬¸ ìƒì„±

### ë¡œì»¬ ì§ˆë¬¸ ìƒì„±ê¸°

**ìœ„ì¹˜**: `/graphrag/query/llm/local_search/question_gen.py`

**ëª©ì **: ì»¨í…ìŠ¤íŠ¸ì™€ ëŒ€í™” ê¸°ë¡ì—ì„œ ê²€ìƒ‰ ì§ˆë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤.

**ê¸°ëŠ¥**:
- ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ì§ˆë¬¸ ìƒì„±
- ëŒ€í™” ê¸°ë¡ í†µí•©
- ë©”íƒ€ë°ì´í„°ê°€ í¬í•¨ëœ êµ¬ì¡°í™”ëœ ì¶œë ¥
- ë‹¤ì¤‘ ì§ˆë¬¸ ìƒì„±

**ì§ˆë¬¸ í˜•ì‹**:
```python
{
    "question": "AI ì—°êµ¬ì— ëˆ„ê°€ ê´€ì—¬í•˜ê³  ìˆëŠ”ê°€?",
    "entities": ["entity1", "entity2"],
    "relationships": ["rel1", "rel2"],
    "metadata": {...}
}
```

## âš¡ ì„±ëŠ¥ ìµœì í™”

### í† í° ê´€ë¦¬
- í† í° ì¸ì‹ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”©
- êµ¬ì„± ìš”ì†Œë³„ êµ¬ì„± ê°€ëŠ¥í•œ í† í° ì œí•œ
- tiktokenì„ í†µí•œ íš¨ìœ¨ì ì¸ í† í° ìˆ˜ ê³„ì‚°
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ

### ë³‘ë ¬ ì²˜ë¦¬
- ì»¤ë®¤ë‹ˆí‹° ë¦¬í¬íŠ¸ ë³‘ë ¬ ì²˜ë¦¬ (ê¸€ë¡œë²Œ ê²€ìƒ‰)
- ì—”í‹°í‹° ì„ë² ë”© ë™ì‹œ ê³„ì‚°
- ë°°ì¹˜ ë²¡í„° ì‘ì—…

### ìºì‹±
- LLM ì‘ë‹µ ìºì‹±
- ë²¡í„° ìœ ì‚¬ë„ ê²°ê³¼ ìºì‹±
- ì»¨í…ìŠ¤íŠ¸ ë¹Œë” ìºì‹±

## ğŸ“Š ë°ì´í„° íë¦„

### ë¡œì»¬ ê²€ìƒ‰ íë¦„

```
ì¿¼ë¦¬ -> ì—”í‹°í‹° ì¶”ì¶œ -> ì»¨í…ìŠ¤íŠ¸ ë¹Œë”© ->
ê´€ê³„ ìˆ˜ì§‘ -> í…ìŠ¤íŠ¸ ìœ ë‹› ê²€ìƒ‰ ->
LLM ìƒì„± -> ì‘ë‹µ
```

### ê¸€ë¡œë²Œ ê²€ìƒ‰ íë¦„

```
ì¿¼ë¦¬ -> ì»¤ë®¤ë‹ˆí‹° ì„ íƒ -> ë§µ ë‹¨ê³„ (ë³‘ë ¬) ->
ë¦¬ë“€ìŠ¤ ë‹¨ê³„ -> LLM ìƒì„± -> ì‘ë‹µ
```

### DRIFT ê²€ìƒ‰ íë¦„

```
ì¿¼ë¦¬ -> í”„ë¼ì´ë¨¸ ë‹¨ê³„ -> ì´ˆê¸° ì»¨í…ìŠ¤íŠ¸ ->
ì •ì œ ë‹¨ê³„ -> ë°˜ë³µì  í™•ì¥ ->
ìµœì¢… ìƒì„± -> ì‘ë‹µ
```

## âš™ï¸ êµ¬ì„±

### ë¡œì»¬ ê²€ìƒ‰ êµ¬ì„±

```yaml
local_search:
  text_unit_prop: 0.5      # í…ìŠ¤íŠ¸ ìœ ë‹›ì— 50% í† í°
  community_prop: 0.25     # ì»¤ë®¤ë‹ˆí‹°ì— 25% í† í°
  conversation_history_max_turns: 10
  top_k_entities: 10
  top_k_relationships: 10
  max_context_tokens: 12000
```

### ê¸€ë¡œë²Œ ê²€ìƒ‰ êµ¬ì„±

```yaml
global_search:
  max_tokens: 12000
  data_max_tokens: 12000
  map_max_tokens: 1000
  reduce_max_tokens: 2000
  concurrency: 32
```

### DRIFT ê²€ìƒ‰ êµ¬ì„±

```yaml
drift_search:
  max_tokens: 12000
  primer_max_tokens: 2000
  max_context_tokens: 8000
```

## ğŸ”— ê´€ë ¨ êµ¬ì„± ìš”ì†Œ

- [[Index Module]] - ì§€ì‹ ê·¸ë˜í”„ ë¹Œë”©
- [[Entity]] - ì§€ì‹ ê·¸ë˜í”„ ì—”í‹°í‹°
- [[Relationship]] - ì—”í‹°í‹° ê´€ê³„
- [[Community]] - ì»¤ë®¤ë‹ˆí‹° êµ¬ì¡°
- [[Text Unit]] - í…ìŠ¤íŠ¸ ì²­í¬
- [[Storage Module]] - ë²¡í„° ì„ë² ë”©

## ğŸ“š ì£¼ìš” íŒŒì¼

| íŒŒì¼ | ìš©ë„ |
|------|---------|
| `/graphrag/query/llm/local_search/local_search.py` | ë¡œì»¬ ê²€ìƒ‰ |
| `/graphrag/query/llm/global_search/global_search.py` | ê¸€ë¡œë²Œ ê²€ìƒ‰ |
| `/graphrag/query/llm/drift_search/drift_search.py` | DRIFT ê²€ìƒ‰ |
| `/graphrag/query/llm/basic_search/basic_search.py` | ê¸°ë³¸ ê²€ìƒ‰ |
| `/graphrag/query/factory.py` | ì¿¼ë¦¬ ì—”ì§„ íŒ©í† ë¦¬ |
| `/graphrag/query/callbacks.py` | ì¿¼ë¦¬ ì½œë°± |

---
*ì°¸ê³ : [[Architecture Overview]], [[Local Search]], [[Global Search]], [[Configuration Module]]*
